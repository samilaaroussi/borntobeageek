function preload(){getUrlParameter=getUrlParameter(),game.load.image("room","assets/static/room.png"),game.load.image("boxPokemon","assets/static/boxPokemon.png"),game.load.image("boxSouthPark","assets/static/boxSouthPark.png"),game.load.image("boxMarvel","assets/static/boxMarvel.png"),game.load.image("boxMario","assets/static/boxMario.png"),game.load.image("trash","assets/static/trash.png"),game.load.audio("tetris",["assets/audio/tetris.mp3","assets/audio/tetris.ogg"]),game.load.audio("dbd",["assets/audio/dbd.mp3","assets/audio/dbd.ogg"]),game.load.image("menu","assets/button.png",270,180);var e="assets/",a=".png";$.ajax({url:e,success:function(e){$(e).find("a:contains("+a+")").each(function(e,a){var t=this.href.replace(".png","").replace(window.location.host+"/assets/","").replace("http://","");game.load.image(t,"assets/objects/"+t+".png"),nameObjects.push(t)})}})}function create(){function e(e){if(game.paused){var a=g/2-135,t=g/2+135,o=u/2-90,s=u/2+90;if(e.x>a&&e.x<t&&e.y>o&&e.y<s){var r=e.x-a,i=e.y-o,n=Math.floor(r/90)+3*Math.floor(i/90);3>n?(n="fullsreen",gofull()):(n="quit",storage(),document.location.href="index.html")}else menu.destroy(),choiseLabel.destroy(),p.destroy(),game.paused=!1}}game.physics.startSystem(Phaser.Physics.BOX2D),game.physics.box2d.setBoundsToWorld(),game.physics.box2d.gravity.y=800;var a=game.add.sprite(0,0,"room");a.smoothed=!1,game.scale.fullScreenScaleMode=Phaser.ScaleManager.EXACT_FIT,time=game.add.text(game.width-200,110,"Temps : "+counter,{font:"21px Arial",fill:"#FFFFFF"}),time.stroke="#333333",time.strokeThickness=5;var t=new Phaser.Physics.Box2D.Body(this.game,null,915,400,100);t.setPolygon([-40,-120,-40,200,80,200,80,-120]);var o=new Phaser.Physics.Box2D.Body(this.game,null,320,250,100);o.setRectangle(45,10,0,0,0);var s=new Phaser.Physics.Box2D.Body(this.game,null,320,250,100);s.setRectangle(45,10,0,130,0);var r=new Phaser.Physics.Box2D.Body(this.game,null,320,250,100);if(r.setRectangle(183,5,176,-72,0),getUrlParameter.includes("poke")){var i=game.add.sprite(600,610,"boxPokemon");game.physics.box2d.enable(i),i.body.fixedRotation=!0,i.body["static"]=!0,pokemonText=game.add.text(590,640,"0",{font:"21px Arial",fill:"#FFFFFF"}),pokemonText.stroke="#333333",pokemonText.strokeThickness=5,i.body.setCategoryContactCallback(2,boxCallback,this)}if(getUrlParameter.includes("south")){var n=game.add.sprite(200,610,"boxSouthPark");game.physics.box2d.enable(n),n.body.fixedRotation=!0,n.body["static"]=!0,southText=game.add.text(190,640,"0",{font:"21px Arial",fill:"#FFFFFF"}),southText.stroke="#333333",southText.strokeThickness=5,n.body.setCategoryContactCallback(2,boxCallback,this)}if(getUrlParameter.includes("marvel")){var m=game.add.sprite(400,610,"boxMarvel");game.physics.box2d.enable(m),m.body.fixedRotation=!0,m.body["static"]=!0,marvelText=game.add.text(390,640,"0",{font:"21px Arial",fill:"#FFFFFF"}),marvelText.stroke="#333333",marvelText.strokeThickness=5,m.body.setCategoryContactCallback(2,boxCallback,this)}if(getUrlParameter.includes("trash")){var l=game.add.sprite(40,605,"trash");game.physics.box2d.enable(l),l.body.fixedRotation=!0,l.body["static"]=!0,trashText=game.add.text(25,640," 0",{font:"21px Arial",fill:"#FFFFFF"}),trashText.stroke="#333333",trashText.strokeThickness=5,l.body.setCategoryContactCallback(2,boxCallback,this)}if(getUrlParameter.includes("mario")){var d=game.add.sprite(800,610,"boxMario");game.physics.box2d.enable(d),d.body.fixedRotation=!0,d.body["static"]=!0,marioText=game.add.text(790,640,"0",{font:"21px Arial",fill:"#FFFFFF"}),marioText.stroke="#333333",marioText.strokeThickness=5,d.body.setCategoryContactCallback(2,boxCallback,this)}var c=game.add.group();c.enableBody=!0,c.physicsBodyType=Phaser.Physics.BOX2D,$.each(nameObjects,function(e,a){var t=c.create(Math.floor(Math.random()*game.width-100),Math.floor(Math.random()*game.height-100),a);t.body.setCollisionCategory(2)}),game.input.onDown.add(mouseDragStart,this),game.input.addMoveCallback(mouseDragMove,this),game.input.onUp.add(mouseDragEnd,this),game.time.events.loop(Phaser.Timer.SECOND,updateCounter,this);var g=game.width,u=game.height,h=game.add.graphics();h.beginFill(0,.7),h.drawRect(0,0,g,40),pause_label=game.add.text(g-100,10,"Menu",{font:"24px Arial",fill:"#fff"}),pause_label.inputEnabled=!0;var p;pause_label.events.onInputUp.add(function(){game.paused=!0,p=game.add.graphics(),p.beginFill(0,.7),p.drawRect(0,0,game.width,game.height),menu=game.add.sprite(g/2,u/2,"menu"),menu.anchor.setTo(.5,.5),choiseLabel=game.add.text(g/2,u-150,"Cliquez en dehors du menu pour continuer",{font:"30px Arial",fill:"#fff"}),choiseLabel.anchor.setTo(.5,.5)}),game.input.onDown.add(e,self)}function mouseDragStart(){game.physics.box2d.mouseDragStart(game.input.mousePointer),mouseDown=!0}function mouseDragMove(){game.physics.box2d.mouseDragMove(game.input.mousePointer)}function mouseDragEnd(){game.physics.box2d.mouseDragEnd(),mouseDown=!1}function boxCallback(e,a,t,o,s){if(s){if("boxPokemon"==e.sprite.key&&a.sprite.key.includes("pokemon")&&mouseDown){poke++,inTheBox(pokemonText,poke);var r=nameObjects.indexOf(a.sprite.key);-1!=r&&nameObjects.splice(r,1),a.sprite.destroy()}if("boxSouthPark"==e.sprite.key&&a.sprite.key.includes("south")&&mouseDown){south++,inTheBox(southText,south);var r=nameObjects.indexOf(a.sprite.key);-1!=r&&nameObjects.splice(r,1),a.sprite.destroy()}if("boxMarvel"==e.sprite.key&&a.sprite.key.includes("marvel")&&mouseDown){marvel++,inTheBox(marvelText,marvel);var r=nameObjects.indexOf(a.sprite.key);-1!=r&&nameObjects.splice(r,1),a.sprite.destroy()}if("boxMario"==e.sprite.key&&a.sprite.key.includes("mario")&&mouseDown){mario++,inTheBox(marioText,mario);var r=nameObjects.indexOf(a.sprite.key);-1!=r&&nameObjects.splice(r,1),a.sprite.destroy()}if("trash"==e.sprite.key&&mouseDown){trash++,inTheBox(trashText,trash);var r=nameObjects.indexOf(a.sprite.key);-1!=r&&nameObjects.splice(r,1),a.sprite.destroy()}if(0==nameObjects.length){var i=game.add.graphics();i.beginFill(0,.7),i.drawRect(0,0,w,h),storage()}}}function storage(){console.log("south: "+south+" pokemon: "+poke+" mario: "+mario+" trash: "+trash+" counter: "+counter);var e={southpark:south,pokemon:poke,mario:mario,trash:trash,counter:counter};if(null===sessionStorage.getItem("profil")){var a=JSON.stringify(e);sessionStorage.setItem("profil",a)}else{var t=sessionStorage.getItem("profil"),o=JSON.parse(t);if(o.counter<counter){var a=JSON.stringify(e);sessionStorage.setItem("profil",a)}}}function inTheBox(e,a){e.text=a}function updateCounter(){counter++,time.setText("Temps : "+counter)}function gofull(){game.scale.isFullScreen?game.scale.stopFullScreen():game.scale.startFullScreen(!0)}function render(){}var game=new Phaser.Game(1e3,667,Phaser.CANVAS,"GameContainer",{preload:preload,create:create,render:render}),nameObjects=[],mouseDown=!1,text1,south=0,poke=0,mario=0,marvel=0,trash=0,trashText=0,marioText=0,marvelText=0,southText=0,pokemonText=0,counter=0,getUrlParameter=null,getUrlParameter=function(){return decodeURIComponent(window.location.search.substring(1))};